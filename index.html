<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Princess Reading Adventure</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .slide {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid #ff69b4;
            display: none;
        }
        
        .slide.active {
            display: block;
        }
        
        .slide h1 {
            color: #ff1493;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .slide h2 {
            color: #ff69b4;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .princess-scene {
            background: linear-gradient(to bottom, #87ceeb 0%, #98fb98 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            position: relative;
            min-height: 200px;
        }
        
        .princess {
            width: 120px;
            height: 120px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
            object-fit: contain;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            min-height: 60px;
            padding: 10px;
            border: 2px dashed #ff69b4;
            border-radius: 10px;
            background: rgba(255, 105, 180, 0.1);
        }
        
        .word-bank.drag-over {
            background: rgba(255, 105, 180, 0.3);
            border-color: #ff1493;
        }
        
        .word {
            background: #ff69b4;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: grab;
            font-size: 1.5em;
            font-weight: bold;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            user-select: none;
            touch-action: none;
        }
        
        .word:hover {
            background: #ff1493;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .word:active, .word.dragging {
            cursor: grabbing;
            transform: scale(1.1) rotate(5deg);
            z-index: 1000;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        
        .word.used {
            background: #ddd;
            color: #999;
            cursor: not-allowed;
        }
        
        .sentence-builder {
            background: #f0f8ff;
            border: 3px dashed #ff69b4;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            color: #333;
            position: relative;
        }
        
        .sentence-builder.drag-over {
            background: #e6ffe6;
            border-color: #32cd32;
            transform: scale(1.02);
        }
        
        .sentence-word {
            background: #ffb6c1;
            padding: 8px 12px;
            margin: 0 5px;
            border-radius: 10px;
            display: inline-block;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
            touch-action: none;
        }
        
        .sentence-word:hover {
            background: #ff91a4;
        }
        
        .sentence-word:active, .sentence-word.dragging {
            cursor: grabbing;
            transform: scale(1.1);
            z-index: 1000;
        }
        
        .navigation {
            text-align: center;
            margin: 20px 0;
        }
        
        .nav-btn {
            background: #ff69b4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2em;
            cursor: pointer;
            margin: 0 10px;
            transition: background 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #ff1493;
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .progress {
            background: #e0e0e0;
            border-radius: 10px;
            height: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #ff69b4, #ff1493);
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .celebration {
            text-align: center;
            font-size: 3em;
            color: #ff1493;
            margin: 20px 0;
            display: none;
        }
        
        .celebration.show {
            display: block;
            animation: bounce 1s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        .instructions {
            background: #fffacd;
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 1.1em;
            color: #333;
        }
        
        .read-aloud {
            background: #e6f3ff;
            border: 2px solid #4169e1;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 1.2em;
            color: #1e90ff;
            text-align: center;
        }
        
        .speak-btn {
            background: #4169e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s ease;
        }
        
        .speak-btn:hover {
            background: #1e90ff;
        }
        
        .speak-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .word-highlight {
            background: #ffff00 !important;
            color: #000 !important;
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .clear-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px auto;
            transition: background 0.3s ease;
            display: none;
            text-align: center;
        }
        
        .clear-btn:hover {
            background: #ff5252;
        }
        
        .clear-btn.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    
    <!-- Slide 1: Introduction -->
    <div class="slide active">
        <h1>ğŸ° Princess Reading Adventure! ğŸ‘‘</h1>
        <div class="princess-scene">
            <img src="images/princess.png" alt="Princess" class="princess">
            <h2>Welcome to our magical story world!</h2>
            <p style="font-size: 1.3em; color: #666;">Today we're going to build sentences to tell princess stories!</p>
        </div>
        <div class="instructions">
            <strong>Remember:</strong> Drag words OUT LOUD as you move them! This helps your brain understand the story you're building.
        </div>
    </div>
    
    <!-- Slide 2: Simple Action -->
    <div class="slide">
        <h1>The Princess and the Cat ğŸ±</h1>
        <div class="princess-scene">
            <img src="images/princess.png" alt="Princess" class="princess">
            <div style="font-size: 3em; margin-left: 20px;">ğŸ±</div>
        </div>
        <div class="instructions">
            <strong>Your turn:</strong> Drag the words to the sentence box below! Read each word as you drag it.
        </div>
        <div class="word-bank" ondrop="dropToTrash(event, 0)" ondragover="allowDrop(event)">
            <span class="word" draggable="true" data-word="The">The</span>
            <span class="word" draggable="true" data-word="cat">cat</span>
            <span class="word" draggable="true" data-word="sat">sat</span>
        </div>
        <div class="sentence-builder" id="sentence0" ondrop="drop(event, 0)" ondragover="allowDrop(event)">
            <span style="color: #999;">Drag words here to build your sentence...</span>
        </div>
        <div style="text-align: center;">
            <button class="clear-btn" id="clearBtn0" onclick="clearSentence(0)">ğŸ—‘ï¸ Clear & Start Again</button>
        </div>
        <div class="read-aloud" id="readAloud0" style="display: none;">
            <strong>Now read your sentence out loud! ğŸ“–</strong>
            <br>
            <button class="speak-btn" onclick="speakSentence(0)">ğŸ”Š Listen to your sentence</button>
        </div>
        <div class="celebration" id="celebration0">ğŸ‰ Great job! You made a sentence! ğŸ‰</div>
    </div>
    
    <!-- Slide 3: Adding Location -->
    <div class="slide">
        <h1>Where Did the Cat Sit? ğŸª‘</h1>
        <div class="princess-scene">
            <img src="images/princess.png" alt="Princess" class="princess">
            <div style="font-size: 2em; margin: 10px;">ğŸ± ğŸª‘</div>
        </div>
        <div class="instructions">
            <strong>Let's add MORE to our story:</strong> Where did the cat sit? Drag words to build a longer sentence!
        </div>
        <div class="word-bank" ondrop="dropToTrash(event, 1)" ondragover="allowDrop(event)">
            <span class="word" draggable="true" data-word="The">The</span>
            <span class="word" draggable="true" data-word="cat">cat</span>
            <span class="word" draggable="true" data-word="sat">sat</span>
            <span class="word" draggable="true" data-word="on">on</span>
            <span class="word" draggable="true" data-word="it">it</span>
        </div>
        <div class="sentence-builder" id="sentence1" ondrop="drop(event, 1)" ondragover="allowDrop(event)">
            <span style="color: #999;">Drag words here to build your sentence...</span>
        </div>
        <div style="text-align: center;">
            <button class="clear-btn" id="clearBtn1" onclick="clearSentence(1)">ğŸ—‘ï¸ Clear & Start Again</button>
        </div>
        <div class="read-aloud" id="readAloud1" style="display: none;">
            <strong>Read your whole sentence out loud! ğŸ“–</strong>
            <br>
            <button class="speak-btn" onclick="speakSentence(1)">ğŸ”Š Listen to your sentence</button>
        </div>
        <div class="celebration" id="celebration1">ğŸ‰ Amazing! You're telling a story! ğŸ‰</div>
    </div>
    
    <!-- Slide 4: New Character -->
    <div class="slide">
        <h1>The Princess and the Rat ğŸ­</h1>
        <div class="princess-scene">
            <img src="images/princess.png" alt="Princess" class="princess">
            <div style="font-size: 2.5em; margin: 10px;">ğŸ­</div>
        </div>
        <div class="instructions">
            <strong>New story time:</strong> What is the rat doing? Drag words to build a sentence about the rat!
        </div>
        <div class="word-bank" ondrop="dropToTrash(event, 2)" ondragover="allowDrop(event)">
            <span class="word" draggable="true" data-word="The">The</span>
            <span class="word" draggable="true" data-word="rat">rat</span>
            <span class="word" draggable="true" data-word="is">is</span>
            <span class="word" draggable="true" data-word="up">up</span>
        </div>
        <div class="sentence-builder" id="sentence2" ondrop="drop(event, 2)" ondragover="allowDrop(event)">
            <span style="color: #999;">Drag words here to build your sentence...</span>
        </div>
        <div style="text-align: center;">
            <button class="clear-btn" id="clearBtn2" onclick="clearSentence(2)">ğŸ—‘ï¸ Clear & Start Again</button>
        </div>
        <div class="read-aloud" id="readAloud2" style="display: none;">
            <strong>Read your sentence and imagine the story! ğŸ“–</strong>
            <br>
            <button class="speak-btn" onclick="speakSentence(2)">ğŸ”Š Listen to your sentence</button>
        </div>
        <div class="celebration" id="celebration2">ğŸ‰ You're becoming a great story builder! ğŸ‰</div>
    </div>
    
    <!-- Slide 5: The Dad -->
    <div class="slide">
        <h1>The Princess Meets Dad ğŸ‘¨</h1>
        <div class="princess-scene">
            <img src="images/princess.png" alt="Princess" class="princess">
            <div style="font-size: 2.5em; margin: 10px;">ğŸ‘¨</div>
        </div>
        <div class="instructions">
            <strong>Story time:</strong> What is dad doing? Drag words to tell the story!
        </div>
        <div class="word-bank" ondrop="dropToTrash(event, 3)" ondragover="allowDrop(event)">
            <span class="word" draggable="true" data-word="Dad">Dad</span>
            <span class="word" draggable="true" data-word="is">is</span>
            <span class="word" draggable="true" data-word="up">up</span>
            <span class="word" draggable="true" data-word="The">The</span>
            <span class="word" draggable="true" data-word="man">man</span>
            <span class="word" draggable="true" data-word="go">go</span>
        </div>
        <div class="sentence-builder" id="sentence3" ondrop="drop(event, 3)" ondragover="allowDrop(event)">
            <span style="color: #999;">Drag words here to build your sentence...</span>
        </div>
        <div style="text-align: center;">
            <button class="clear-btn" id="clearBtn3" onclick="clearSentence(3)">ğŸ—‘ï¸ Clear & Start Again</button>
        </div>
        <div class="read-aloud" id="readAloud3" style="display: none;">
            <strong>Read your sentence - you're the storyteller! ğŸ“–</strong>
            <br>
            <button class="speak-btn" onclick="speakSentence(3)">ğŸ”Š Listen to your sentence</button>
        </div>
        <div class="celebration" id="celebration3">ğŸ‰ You're amazing at making stories! ğŸ‰</div>
    </div>
    
    <!-- Slide 6: Free Build -->
    <div class="slide">
        <h1>Your Own Princess Story! âœ¨</h1>
        <div class="princess-scene">
            <img src="images/princess.png" alt="Princess" class="princess">
            <div style="font-size: 2em;">âœ¨ğŸ°âœ¨</div>
        </div>
        <div class="instructions">
            <strong>You're the storyteller now!</strong> Drag ANY words to build your own sentence. What story will you tell?
        </div>
        <div class="word-bank" ondrop="dropToTrash(event, 4)" ondragover="allowDrop(event)">
            <span class="word" draggable="true" data-word="The">The</span>
            <span class="word" draggable="true" data-word="cat">cat</span>
            <span class="word" draggable="true" data-word="rat">rat</span>
            <span class="word" draggable="true" data-word="dad">dad</span>
            <span class="word" draggable="true" data-word="boy">boy</span>
            <span class="word" draggable="true" data-word="man">man</span>
            <span class="word" draggable="true" data-word="is">is</span>
            <span class="word" draggable="true" data-word="sat">sat</span>
            <span class="word" draggable="true" data-word="go">go</span>
            <span class="word" draggable="true" data-word="up">up</span>
            <span class="word" draggable="true" data-word="on">on</span>
            <span class="word" draggable="true" data-word="in">in</span>
            <span class="word" draggable="true" data-word="to">to</span>
            <span class="word" draggable="true" data-word="it">it</span>
            <span class="word" draggable="true" data-word="be">be</span>
            <span class="word" draggable="true" data-word="if">if</span>
            <span class="word" draggable="true" data-word="no">no</span>
        </div>
        <div class="sentence-builder" id="sentence4" ondrop="drop(event, 4)" ondragover="allowDrop(event)">
            <span style="color: #999;">Drag words here to build your sentence...</span>
        </div>
        <div style="text-align: center;">
            <button class="clear-btn" id="clearBtn4" onclick="clearSentence(4)">ğŸ—‘ï¸ Clear & Start Again</button>
        </div>
        <div class="read-aloud" id="readAloud4" style="display: none;">
            <strong>Read your amazing story sentence! ğŸ“–</strong>
            <br>
            <button class="speak-btn" onclick="speakSentence(4)">ğŸ”Š Listen to your sentence</button>
        </div>
        <div class="celebration" id="celebration4">ğŸ‰ You're a fantastic storyteller! ğŸ‰</div>
    </div>
    
    <!-- Navigation -->
    <div class="navigation">
        <button class="nav-btn" onclick="previousSlide()">â† Previous</button>
        <button class="nav-btn" onclick="nextSlide()">Next â†’</button>
    </div>
    
    <script>
        let currentSlide = 0;
        let draggedElement = null;
        let draggedFromSentence = false;
        let draggedWordIndex = -1;
        const totalSlides = 6;
        const sentences = ['', '', '', '', ''];
        
        function updateProgress() {
            const progress = ((currentSlide + 1) / totalSlides) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }
        
        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => slide.classList.remove('active'));
            slides[index].classList.add('active');
            updateProgress();
            
            // Reset word visibility for the new slide
            if (index > 0) { // Skip intro slide
                const slideIndex = index - 1;
                resetWordVisibility(slideIndex);
            }
        }
        
        function resetWordVisibility(slideIndex) {
            const currentSlideElement = document.querySelector('.slide.active');
            if (currentSlideElement) {
                // First show all words
                const wordElements = currentSlideElement.querySelectorAll('.word[draggable="true"]');
                wordElements.forEach(wordEl => {
                    wordEl.style.display = 'inline-block';
                });
                
                // Then hide words that are in the sentence
                if (sentences[slideIndex] && sentences[slideIndex].trim() !== '') {
                    const wordsInSentence = sentences[slideIndex].split(' ');
                    wordsInSentence.forEach(word => {
                        const wordInBank = currentSlideElement.querySelector('.word[data-word="' + word + '"]');
                        if (wordInBank) {
                            wordInBank.style.display = 'none';
                        }
                    });
                }
            }
        }
        
        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }
        
        function previousSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
            }
        }
        
        // Drag and Drop Functions
        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('drag-over');
        }
        
        function drop(ev, slideIndex) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');
            
            if (!draggedElement) return;
            
            const word = draggedElement.dataset.word || draggedElement.textContent;
            const currentSlideIndex = getCurrentSlideIndex();
            
            if (draggedFromSentence) {
                if (currentSlideIndex === slideIndex) {
                    // Dragging within the same sentence - just rearrange, don't duplicate
                    // The word is already in the sentence, so we don't need to add it again
                    // Just update the display to reflect any position changes
                    resetDragState();
                    return;
                } else {
                    // Moving word from one sentence to another
                    removeWordFromSentence(currentSlideIndex, draggedWordIndex);
                    addWordToSentence(word, slideIndex);
                }
            } else {
                // Adding new word from word bank - hide the word in word bank
                draggedElement.style.display = 'none';
                addWordToSentence(word, slideIndex);
            }
            
            resetDragState();
        }
        
        function dropToTrash(ev, slideIndex) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');
            
            if (!draggedElement || !draggedFromSentence) {
                resetDragState();
                return;
            }
            
            const word = draggedElement.dataset.word || draggedElement.textContent;
            
            // Remove word from sentence
            removeWordFromSentence(getCurrentSlideIndex(), draggedWordIndex);
            
            // Show the word back in the word bank
            showWordInBank(word, slideIndex);
            
            resetDragState();
        }
        
        function addWordToSentence(word, slideIndex) {
            const sentenceBuilder = document.getElementById('sentence' + slideIndex);
            const readAloud = document.getElementById('readAloud' + slideIndex);
            const celebration = document.getElementById('celebration' + slideIndex);
            const clearBtn = document.getElementById('clearBtn' + slideIndex);
            
            // Add word to sentence
            if (sentences[slideIndex] === '') {
                sentences[slideIndex] = word;
            } else {
                sentences[slideIndex] += ' ' + word;
            }
            
            // Update display
            updateSentenceDisplay(slideIndex);
            
            // Show clear button, read aloud prompt
            clearBtn.classList.add('show');
            readAloud.style.display = 'block';
            
            // Show celebration for complete sentences
            if (sentences[slideIndex].split(' ').length >= 3) {
                celebration.classList.add('show');
                setTimeout(() => {
                    celebration.classList.remove('show');
                }, 2000);
            }
        }
        
        function updateSentenceDisplay(slideIndex) {
            const sentenceBuilder = document.getElementById('sentence' + slideIndex);
            
            if (sentences[slideIndex] === '') {
                sentenceBuilder.innerHTML = '<span style="color: #999;">Drag words here to build your sentence...</span>';
                return;
            }
            
            const words = sentences[slideIndex].split(' ');
            let html = '';
            words.forEach((w, i) => {
                html += '<span class="sentence-word" draggable="true" data-word="' + w + '" data-index="' + i + '">' + w + '</span>';
            });
            sentenceBuilder.innerHTML = html;
            
            // Add drag events to sentence words
            const sentenceWords = sentenceBuilder.querySelectorAll('.sentence-word');
            sentenceWords.forEach(wordEl => {
                wordEl.addEventListener('dragstart', function(e) {
                    startDragFromSentence(e, slideIndex);
                });
                wordEl.addEventListener('dragend', function(e) {
                    endDrag(e);
                });
            });
        }
        
        function removeWordFromSentence(slideIndex, wordIndex) {
            const words = sentences[slideIndex].split(' ');
            if (wordIndex >= 0 && wordIndex < words.length) {
                const removedWord = words[wordIndex];
                words.splice(wordIndex, 1);
                sentences[slideIndex] = words.join(' ');
                updateSentenceDisplay(slideIndex);
                
                if (sentences[slideIndex] === '') {
                    document.getElementById('readAloud' + slideIndex).style.display = 'none';
                    document.getElementById('clearBtn' + slideIndex).classList.remove('show');
                }
                
                // Show the removed word back in the word bank
                showWordInBank(removedWord, slideIndex);
            }
        }
        
        function startDragFromSentence(e, slideIndex) {
            draggedElement = e.target;
            draggedFromSentence = true;
            draggedWordIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
        }
        
        function getCurrentSlideIndex() {
            // Find which slide is currently active
            const slides = document.querySelectorAll('.slide');
            for (let i = 0; i < slides.length; i++) {
                if (slides[i].classList.contains('active')) {
                    return Math.max(0, i - 1); // Subtract 1 because first slide is intro
                }
            }
            return currentSlide - 1; // Fallback
        }
        
        function showWordInBank(word, slideIndex) {
            // Find the word in the current slide's word bank and show it
            const currentSlideElement = document.querySelector('.slide.active');
            if (currentSlideElement) {
                const wordElements = currentSlideElement.querySelectorAll('.word[data-word="' + word + '"]');
                wordElements.forEach(wordEl => {
                    wordEl.style.display = 'inline-block';
                });
            }
        }
        
        function startDrag(e) {
            draggedElement = e.target;
            draggedFromSentence = false;
            draggedWordIndex = -1;
            e.target.classList.add('dragging');
        }
        
        function endDrag(e) {
            e.target.classList.remove('dragging');
        }
        
        function resetDragState() {
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
            }
            draggedElement = null;
            draggedFromSentence = false;
            draggedWordIndex = -1;
            
            // Remove drag-over class from all sentence builders and word banks
            document.querySelectorAll('.sentence-builder, .word-bank').forEach(element => {
                element.classList.remove('drag-over');
            });
        }
        
        // Add drag event listeners to word bank items
        function initializeDragEvents() {
            const wordElements = document.querySelectorAll('.word[draggable="true"]');
            wordElements.forEach(wordEl => {
                wordEl.addEventListener('dragstart', startDrag);
                wordEl.addEventListener('dragend', endDrag);
            });
            
            // Add dragenter and dragleave events for visual feedback
            const sentenceBuilders = document.querySelectorAll('.sentence-builder');
            sentenceBuilders.forEach(sb => {
                sb.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });
                
                sb.addEventListener('dragleave', function(e) {
                    // Only remove if we're actually leaving the drop zone
                    if (!this.contains(e.relatedTarget)) {
                        this.classList.remove('drag-over');
                    }
                });
            });
            
            // Add dragenter and dragleave events for word banks (trash areas)
            const wordBanks = document.querySelectorAll('.word-bank');
            wordBanks.forEach(wb => {
                wb.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    if (draggedFromSentence) {
                        this.classList.add('drag-over');
                    }
                });
                
                wb.addEventListener('dragleave', function(e) {
                    // Only remove if we're actually leaving the drop zone
                    if (!this.contains(e.relatedTarget)) {
                        this.classList.remove('drag-over');
                    }
                });
            });
        }
        
        function speakSentence(slideIndex) {
            if (sentences[slideIndex] === '') return;
            
            const speakBtn = document.querySelector('#readAloud' + slideIndex + ' .speak-btn');
            const words = sentences[slideIndex].split(' ');
            const sentenceWords = document.querySelectorAll('#sentence' + slideIndex + ' .sentence-word');
            
            if (!speakBtn) return;
            
            if (!('speechSynthesis' in window)) {
                alert('Speech is not supported on this device. Please read the sentence out loud: "' + sentences[slideIndex] + '"');
                return;
            }
            
            speakBtn.disabled = true;
            speakBtn.textContent = 'ğŸ”Š Speaking...';
            
            speechSynthesis.cancel();
            
            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(sentences[slideIndex]);
                utterance.rate = 0.7;
                utterance.volume = 1.0;
                utterance.pitch = 1.0;
                
                const voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    const englishVoice = voices.find(voice => voice.lang.startsWith('en'));
                    if (englishVoice) {
                        utterance.voice = englishVoice;
                    } else {
                        utterance.voice = voices[0];
                    }
                }
                
                utterance.onstart = function() {
                    sentenceWords.forEach(wordEl => wordEl.classList.add('word-highlight'));
                };
                
                utterance.onend = function() {
                    if (speakBtn) {
                        speakBtn.disabled = false;
                        speakBtn.textContent = 'ğŸ”Š Listen to your sentence';
                    }
                    sentenceWords.forEach(wordEl => wordEl.classList.remove('word-highlight'));
                };
                
                utterance.onerror = function(event) {
                    if (speakBtn) {
                        speakBtn.disabled = false;
                        speakBtn.textContent = 'ğŸ”Š Listen to your sentence';
                    }
                    sentenceWords.forEach(wordEl => wordEl.classList.remove('word-highlight'));
                    alert('Speech may not work on this device. Please read out loud: "' + sentences[slideIndex] + '"');
                };
                
                speechSynthesis.speak(utterance);
            }, 100);
        }
        
        function clearSentence(slideIndex) {
            // Get words from sentence before clearing
            const wordsToRestore = sentences[slideIndex].split(' ').filter(word => word.trim() !== '');
            
            sentences[slideIndex] = '';
            const sentenceBuilder = document.getElementById('sentence' + slideIndex);
            const readAloud = document.getElementById('readAloud' + slideIndex);
            const clearBtn = document.getElementById('clearBtn' + slideIndex);
            
            sentenceBuilder.innerHTML = '<span style="color: #999;">Drag words here to build your sentence...</span>';
            readAloud.style.display = 'none';
            clearBtn.classList.remove('show');
            
            // Restore all words to the word bank
            wordsToRestore.forEach(word => {
                showWordInBank(word, slideIndex);
            });
        }
        
        // Initialize
        updateProgress();
        initializeDragEvents();
        
        // Initialize word visibility for the first content slide
        setTimeout(() => {
            if (currentSlide === 0) {
                resetWordVisibility(0);
            }
        }, 100);
        
        // Initialize speech synthesis voices
        if ('speechSynthesis' in window) {
            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                console.log('Available voices:', voices.length);
            }
            
            speechSynthesis.onvoiceschanged = loadVoices;
            loadVoices();
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'ArrowLeft') previousSlide();
        });
        
        // Cleanup drag state on mouse up anywhere
        document.addEventListener('mouseup', resetDragState);
        document.addEventListener('touchend', resetDragState);
    </script>
</body>
</html>